<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:NdcApp.Converters"
             xmlns:local="clr-namespace:NdcApp"
             x:Class="NdcApp.ConferencePlanPage"
             BackgroundColor="{StaticResource NdcPrimary}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:SelectedTextConverter x:Key="SelectedTextConverter" />
            <converters:SelectedColorConverter x:Key="SelectedColorConverter" />
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
            
            <!-- Enhanced Talk Card Style -->
            <Style x:Key="TalkCard" TargetType="Border">
                <Setter Property="Stroke" Value="{StaticResource NdcAccent}" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="StrokeThickness" Value="2" />
                <Setter Property="StrokeShape" Value="RoundRectangle 12" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="Margin" Value="0,8" />
            </Style>
            
            <Style x:Key="TalkTitle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource NdcAccent}" />
                <Setter Property="LineBreakMode" Value="WordWrap" />
            </Style>
            
            <Style x:Key="TalkSpeaker" TargetType="Label">
                <Setter Property="FontSize" Value="15" />
                <Setter Property="FontAttributes" Value="Italic" />
                <Setter Property="TextColor" Value="{StaticResource NdcTextSecondary}" />
                <Setter Property="Margin" Value="0,4,0,0" />
            </Style>
            
            <Style x:Key="TalkInfo" TargetType="Label">
                <Setter Property="FontSize" Value="13" />
                <Setter Property="TextColor" Value="{StaticResource NdcText}" />
                <Setter Property="Margin" Value="0,2,0,0" />
            </Style>
            
            <Style x:Key="FilterButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{StaticResource NdcAccent}" />
                <Setter Property="BorderColor" Value="{StaticResource NdcAccent}" />
                <Setter Property="BorderWidth" Value="2" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Padding" Value="12,8" />
            </Style>
            
            <Style x:Key="ActionButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource NdcAccent}" />
                <Setter Property="TextColor" Value="{StaticResource NdcPrimary}" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Padding" Value="12,8" />
                <Setter Property="Margin" Value="0,8,0,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ScrollView>
        <VerticalStackLayout Padding="0" Spacing="0" BackgroundColor="{StaticResource NdcPrimary}">
            <!-- Header Section -->
            <VerticalStackLayout Padding="20,40,20,20" Spacing="16">
                <Label Text="Conference Plan" 
                       Style="{StaticResource NdcHeadline}" />
                
                <SearchBar x:Name="SearchBarControl" 
                           Style="{StaticResource NdcSearchBar}"
                           Placeholder="Search talks, speakers, categories..." 
                           TextChanged="OnSearchTextChanged" />
            </VerticalStackLayout>

            <!-- Filter Controls -->
            <FlexLayout Margin="20,0,20,20" 
                       Direction="Row" 
                       Wrap="Wrap" 
                       JustifyContent="Start" 
                       AlignItems="Start">
                <Button x:Name="ShowAllBtn" 
                        Text="All Talks" 
                        Style="{StaticResource FilterButton}"
                        Clicked="OnShowAllClicked" />
                <Button x:Name="ShowSelectedBtn" 
                        Text="My Talks" 
                        Style="{StaticResource FilterButton}"
                        Clicked="OnShowSelectedClicked" />
                <Button x:Name="NotificationsBtn" 
                        Text="ğŸ””" 
                        Style="{StaticResource FilterButton}"
                        Clicked="OnNotificationsClicked" 
                        ToolTipProperties.Text="View upcoming notifications" />
                <Picker x:Name="SortPicker" 
                        Title="Sort by..." 
                        SelectedIndexChanged="OnSortPickerChanged"
                        TextColor="{StaticResource NdcAccent}"
                        TitleColor="{StaticResource NdcText}">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>Standard</x:String>
                            <x:String>Presenter</x:String>
                            <x:String>Category</x:String>
                            <x:String>Rating</x:String>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>
            </FlexLayout>

            <!-- Talks List -->
            <RefreshView x:Name="RefreshViewControl" Refreshing="OnRefresh">
                <CollectionView x:Name="TalksCollectionView" 
                               Margin="20,0,20,20"
                               SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="local:TalkDisplayItem">
                            <SwipeView>
                                <SwipeView.RightItems>
                                    <SwipeItems>
                                        <SwipeItem Text="Select" 
                                                   BackgroundColor="{StaticResource NdcAccent}"
                                                   CommandParameter="{Binding .}"
                                                   Invoked="OnSwipeSelectTalk"
                                                   IsVisible="{Binding IsSelected, Converter={StaticResource InverseBoolConverter}}" />
                                        <SwipeItem Text="Remove" 
                                                   BackgroundColor="Red"
                                                   CommandParameter="{Binding .}"
                                                   Invoked="OnSwipeDeselectTalk"
                                                   IsVisible="{Binding IsSelected}" />
                                    </SwipeItems>
                                </SwipeView.RightItems>
                                
                                <Border Style="{StaticResource TalkCard}">
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding Talk.Title}" 
                                               Style="{StaticResource TalkTitle}" />
                                        
                                        <Label Text="{Binding Talk.Speaker}" 
                                               Style="{StaticResource TalkSpeaker}" />
                                        
                                        <Label Text="{Binding RatingDisplay}" 
                                               Style="{StaticResource TalkInfo}"
                                               TextColor="{StaticResource NdcAccent}"
                                               IsVisible="{Binding HasRating}" />
                                        
                                        <HorizontalStackLayout Spacing="16">
                                            <Label Text="{Binding Talk.Day}" 
                                                   Style="{StaticResource TalkInfo}" />
                                            <Label Text="{Binding Talk.StartTime}" 
                                                   Style="{StaticResource TalkInfo}" />
                                            <Label Text="{Binding Talk.Room, StringFormat='Room {0}'}" 
                                                   Style="{StaticResource TalkInfo}" />
                                        </HorizontalStackLayout>
                                        
                                        <Button Text="{Binding IsSelected, Converter={StaticResource SelectedTextConverter}}"
                                                BackgroundColor="{Binding IsSelected, Converter={StaticResource SelectedColorConverter}}"
                                                CommandParameter="{Binding .}"
                                                Clicked="OnSelectTalk"
                                                Style="{StaticResource ActionButton}"
                                                IsVisible="{Binding IsSelected, Converter={StaticResource InverseBoolConverter}}" />
                                        
                                        <Button Text="Remove from Plan"
                                                BackgroundColor="Transparent"
                                                TextColor="Red"
                                                BorderColor="Red"
                                                BorderWidth="2"
                                                CommandParameter="{Binding .}"
                                                Clicked="OnDeselectTalk"
                                                Style="{StaticResource ActionButton}"
                                                IsVisible="{Binding IsSelected}" />
                                    </VerticalStackLayout>
                                </Border>
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
